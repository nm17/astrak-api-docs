


<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Astrak API v1.0</title>

    <style>
    </style>
    <link rel="stylesheet" media="screen" href="pub/css/screen.css">
    <link rel="stylesheet" media="print" href="pub/css/print.css">
    <link rel="stylesheet" media="screen" href="pub/css/darkula.css">
    
      <script src="source/javascripts/lib/_jquery.js"></script>
<script src="source/javascripts/lib/_jquery.highlight.js"></script>
<script src="source/javascripts/lib/_lunr.js"></script>
<script src="source/javascripts/lib/_imagesloaded.min.js"></script>
<script src="source/javascripts/lib/_energize.js"></script>
<script src="source/javascripts/app/_lang.js"></script>
<script src="source/javascripts/app/_search.js"></script>
<script src="source/javascripts/app/_toc.js"></script>
<script type="text/javascript">
$(function() {
  loadToc($('#toc'), '.toc-link', '.toc-list-h2, .toc-list-h3, .toc-list-h4, .toc-list-h5, .toc-list-h6', 10);
  setupLanguages($('body').data('languages'));
  $('.content').imagesLoaded( function() {
    recacheHeights();
    refreshToc();
  });
});

window.onpopstate = function() {
  activateLanguage(getLanguageFromQueryString());
};
</script>

    
    <meta name="theme-color" content="#F3F7F9" />
<!-- Renderer: Shins v2.4.1-0 -->
  </head>

  <body data-languages="[&quot;python&quot;,&quot;js&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="source/images/navbar.png" class="undefined" alt="Navigation">
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="source/images/logo.png" class="logo" alt="Logo">
      
        <div class="lang-selector">
          
            
              <a href="#" data-language-name="python">Python</a>
            
          
            
              <a href="#" data-language-name="js">Javascript</a>
            
          
        </div>
      
      
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      
      <div id="toc" class="toc-list-h1">
	  	<ul class="toc-list-h1">
        
          <li>
            <a href="#astrak-api" class="toc-h1 toc-link" data-title="Astrak API v1.0">Astrak API v1.0</a>
            
              <ul class="toc-list-h2">
                
                  <li>
                    <a href="#---------callback----------------------" class="toc-h2 toc-link" data-title="">&#x423;&#x43A;&#x430;&#x437;&#x430;&#x43D;&#x438;&#x435; Callback &#x434;&#x43B;&#x44F; &#x43F;&#x43E;&#x43B;&#x443;&#x447;&#x435;&#x43D;&#x438;&#x44F; &#x441;&#x43E;&#x431;&#x44B;&#x442;&#x438;&#x439;</a>
                    
                  </li>
                
                  <li>
                    <a href="#----------------------------long-polling" class="toc-h2 toc-link" data-title="">&#x41F;&#x43E;&#x43B;&#x443;&#x447;&#x435;&#x43D;&#x438;&#x435; &#x441;&#x43E;&#x431;&#x44B;&#x442;&#x438;&#x439; &#x441; &#x43F;&#x43E;&#x43C;&#x43E;&#x449;&#x44C;&#x44E; Long Polling</a>
                    
                  </li>
                
                  <li>
                    <a href="#------------------" class="toc-h2 toc-link" data-title="">&#x417;&#x430;&#x440;&#x435;&#x433;&#x438;&#x441;&#x442;&#x440;&#x438;&#x440;&#x43E;&#x432;&#x430;&#x442;&#x44C;&#x441;&#x44F;</a>
                    
                  </li>
                
                  <li>
                    <a href="#---------------" class="toc-h2 toc-link" data-title="">&#x417;&#x430;&#x439;&#x442;&#x438; &#x432; &#x441;&#x438;&#x441;&#x442;&#x435;&#x43C;&#x443;</a>
                    
                  </li>
                
                  <li>
                    <a href="#--------------------------" class="toc-h2 toc-link" data-title="">&#x41F;&#x43E;&#x434;&#x442;&#x432;&#x435;&#x440;&#x434;&#x438;&#x442;&#x44C; &#x430;&#x43A;&#x43A;&#x430;&#x443;&#x43D;&#x442; &#x43F;&#x43E; &#x441;&#x43C;&#x441;</a>
                    
                  </li>
                
                  <li>
                    <a href="#-----------------------------" class="toc-h2 toc-link" data-title="">&#x41F;&#x440;&#x43E;&#x432;&#x435;&#x440;&#x438;&#x442;&#x44C; &#x442;&#x43E;&#x43A;&#x435;&#x43D; &#x43D;&#x430; &#x432;&#x430;&#x43B;&#x438;&#x434;&#x43D;&#x43E;&#x441;&#x442;&#x44C;</a>
                    
                  </li>
                
                  <li>
                    <a href="#--------------------------------" class="toc-h2 toc-link" data-title="">&#x41E;&#x442;&#x43F;&#x440;&#x430;&#x432;&#x438;&#x442;&#x44C; &#x441;&#x43E;&#x43E;&#x431;&#x449;&#x435;&#x43D;&#x438;&#x435; &#x43F;&#x43E;&#x43B;&#x44C;&#x437;&#x43E;&#x432;&#x430;&#x442;&#x435;&#x43B;&#x44E;</a>
                    
                  </li>
                
                  <li>
                    <a href="#------------------------" class="toc-h2 toc-link" data-title="">&#x41F;&#x43E;&#x43B;&#x443;&#x447;&#x438;&#x442;&#x44C; &#x441;&#x43F;&#x438;&#x441;&#x43E;&#x43A; &#x434;&#x438;&#x430;&#x43B;&#x43E;&#x433;&#x43E;&#x432;</a>
                    
                  </li>
                
                  <li>
                    <a href="#-----------------------------" class="toc-h2 toc-link" data-title="">&#x41F;&#x43E;&#x43B;&#x443;&#x447;&#x438;&#x442;&#x44C; &#x441;&#x43E;&#x43E;&#x431;&#x449;&#x435;&#x43D;&#x438;&#x44F; &#x438;&#x437; &#x434;&#x438;&#x430;&#x43B;&#x43E;&#x433;&#x430;</a>
                    
                  </li>
                
                  <li>
                    <a href="#-----------------" class="toc-h2 toc-link" data-title="">&#x423;&#x434;&#x430;&#x43B;&#x438;&#x442;&#x44C; &#x441;&#x43E;&#x43E;&#x431;&#x449;&#x435;&#x43D;&#x438;&#x435;</a>
                    
                  </li>
                
              </ul>
            
          </li>
        
		</ul>
      </div>
      
        <ul class="toc-footer">
          
            <li><a href="https://teleg.run/astrakme">(!) Мы в телеграме</a></li>
          
        </ul>
      
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="astrak-api">Astrak API v1.0</h1>
<blockquote>
<p>Scroll down for code samples, example requests and responses. Select a language for code samples from the tabs above or the mobile navigation menu.</p>
</blockquote>
<p>Обычный мессенджер.</p>
<p>Base URLs:</p>
<ul>
<li><a href="http://afternoon-dusk-97603.herokuapp.com/">http://afternoon-dusk-97603.herokuapp.com/</a></li>
</ul>
<p>Релизы астрак: <a href="https://github.com/catofsof/astrak">https://github.com/catofsof/astrak</a></p>
<h2 id="---------callback----------------------">Указание Callback для получения событий</h2>
<p><a id="opIdpost-events-callback-start"></a></p>
<p><code>POST /events/callback/start</code></p>
<blockquote>
<p>Пример ответа</p>
</blockquote>
<pre class="highlight tab tab-json"><code>{
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"new_message"</span>,
  <span class="hljs-attr">"event"</span>: {
    <span class="hljs-attr">"message_id"</span>: <span class="hljs-number">12</span>,
    <span class="hljs-attr">"to_id"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">"from_id"</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">"created_at"</span>: <span class="hljs-number">1581110027</span>,
    <span class="hljs-attr">"text"</span>: <span class="hljs-string">"this is a new message!"</span>
  }
}
</code></pre>
<p>Используем URL в формате <code>https://ip:port/</code> для вашего же удобства. Вам, конечно, никто не запрещает просто написать туда произвольный текст. Но вы сами прекрасно понимаете, что это совсем не имеет смысла.</p>
<p>Если все успешно, то мы получаем JSON с полем code: 10.</p>
<p>Поднимаем веб-сервер.</p>
<p>На ваш ранее указанный URL будут приходить события в POST формате. Вот пример одного из событий:</p>
<p>При смене URL Callback сервера приходит событие 'callback_deprecated', в котором указаны старый и новый серверы.</p>
<blockquote>
<p>Body parameter</p>
</blockquote>
<pre class="highlight tab tab-json"><code>{
  <span class="hljs-attr">"token"</span>: <span class="hljs-string">"string"</span>,
  <span class="hljs-attr">"callback"</span>: <span class="hljs-string">"string"</span>
}
</code></pre>
<h3 id="---------callback-----------------------parameters">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>In</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>token</td>
<td>body</td>
<td>string</td>
<td>true</td>
<td>Токен пользователя</td>
</tr>
<tr>
<td>callback</td>
<td>body</td>
<td>string</td>
<td>true</td>
<td>URL, на который будут приходить события</td>
</tr>
</tbody>
</table>
<h2 id="----------------------------long-polling">Получение событий с помощью Long Polling</h2>
<p><a id="opIdpost-events-polling"></a></p>
<p><code>POST /events/polling</code></p>
<blockquote>
<p>Пример бота</p>
</blockquote>
<pre class="highlight tab tab-python"><code><span class="hljs-keyword">from</span> astrak <span class="hljs-keyword">import</span> Astrak, Dispatcher, TaskManager
<span class="hljs-keyword">from</span> astrak.types <span class="hljs-keyword">import</span> Message
<span class="hljs-keyword">import</span> logging

logging.basicConfig(level=logging.DEBUG)

astrak = Astrak(username=<span class="hljs-string">"username"</span>, password=<span class="hljs-string">"password"</span>)
dp = Dispatcher(astrak)


<span class="hljs-meta">@dp.message_handler(text="привет")</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">text_handler</span><span class="hljs-params">(message: Message)</span>:</span>
    <span class="hljs-keyword">await</span> message.answer(<span class="hljs-string">"И тебе привет!"</span>)


<span class="hljs-meta">@dp.message_handler(text_contains="шуе")</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">text_handler</span><span class="hljs-params">(message: Message)</span>:</span>
    <span class="hljs-keyword">await</span> message.answer(<span class="hljs-string">"ППШ"</span>)


task_manager = TaskManager(astrak.loop)
task_manager.add_task(dp.dispatch_forever())
task_manager.run()
</code></pre>
<p>Ждем ответ сервера. Как только произойдет какое-либо событие, сервер сразу вернет вам ответ.
События приходят одинаковыми как для Callback, так и для Long Polling.</p>
<blockquote>
<p>Body parameter</p>
</blockquote>
<pre class="highlight tab tab-json"><code>{
  <span class="hljs-attr">"token"</span>: <span class="hljs-string">"string"</span>
}
</code></pre>
<h3 id="----------------------------long-polling-parameters">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>In</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>token</td>
<td>body</td>
<td>string</td>
<td>false</td>
<td>Токен пользователя</td>
</tr>
</tbody>
</table>
<h2 id="------------------">Зарегистрироваться</h2>
<p><a id="opIdpost-users-register"></a></p>
<p><code>POST /users/register</code></p>
<p>Запрос выполняет регистрацию пользователя и возращает актуальный токен.</p>
<p>Пароль не может быть короче 8 символов.</p>
<p>Имя пользователя не может быть длиннее 15 символов.</p>
<p>Если в одном из запросов был введён некорректный номер телефона, то необходимо сделать повторый запрос с тем же логином и паролем, но с другим номером телефона. Придёт сообщение с новым кодом подтвержения. Дальше, как обычно, необходимо подтвердить аккаунт методом /confirm.</p>
<blockquote>
<p>Body parameter</p>
</blockquote>
<pre class="highlight tab tab-json"><code>{
  <span class="hljs-attr">"password"</span>: <span class="hljs-string">"string"</span>,
  <span class="hljs-attr">"username"</span>: <span class="hljs-string">"string"</span>,
  <span class="hljs-attr">"phone"</span>: <span class="hljs-string">"string"</span>
}
</code></pre>
<h3 id="-------------------parameters">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>In</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>password</td>
<td>body</td>
<td>string</td>
<td>true</td>
<td>Пароль пользователя</td>
</tr>
<tr>
<td>username</td>
<td>body</td>
<td>string</td>
<td>true</td>
<td>Имя пользователя</td>
</tr>
<tr>
<td>phone</td>
<td>body</td>
<td>string</td>
<td>true</td>
<td>Номер телефона</td>
</tr>
</tbody>
</table>
<h2 id="---------------">Зайти в систему</h2>
<p><a id="opIdpost-users-login"></a></p>
<p><code>POST /users/login</code></p>
<p>Возращает токен пользователя по логину и паролю.</p>
<blockquote>
<p>Body parameter</p>
</blockquote>
<pre class="highlight tab tab-json"><code>{
  <span class="hljs-attr">"password"</span>: <span class="hljs-string">"string"</span>,
  <span class="hljs-attr">"username"</span>: <span class="hljs-string">"string"</span>
}
</code></pre>
<h3 id="----------------parameters">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>In</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>password</td>
<td>body</td>
<td>string</td>
<td>true</td>
<td>none</td>
</tr>
<tr>
<td>username</td>
<td>body</td>
<td>string</td>
<td>true</td>
<td>none</td>
</tr>
</tbody>
</table>
<h2 id="--------------------------">Подтвердить аккаунт по смс</h2>
<p><a id="opIdpost-users-confirm"></a></p>
<p><code>POST /users/confirm</code></p>
<p>Подтверждает аккаунт по смс сообщению.</p>
<blockquote>
<p>Body parameter</p>
</blockquote>
<pre class="highlight tab tab-json"><code>{
  <span class="hljs-attr">"code"</span>: <span class="hljs-string">"string"</span>,
  <span class="hljs-attr">"phone"</span>: <span class="hljs-string">"string"</span>
}
</code></pre>
<h3 id="---------------------------parameters">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>In</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>body</td>
<td>string</td>
<td>true</td>
<td>none</td>
</tr>
<tr>
<td>phone</td>
<td>body</td>
<td>string</td>
<td>true</td>
<td>none</td>
</tr>
</tbody>
</table>
<h2 id="-----------------------------">Проверить токен на валидность</h2>
<p><a id="opIdget-users-check"></a></p>
<p><code>GET /users/check</code></p>
<p>Запрос проверяет токен на валидность.</p>
<h2 id="--------------------------------">Отправить сообщение пользователю</h2>
<p><a id="opIdpost-messages-send"></a></p>
<p><code>POST /messages/send</code></p>
<p>Отправляет сообщение пользователю.</p>
<blockquote>
<p>Body parameter</p>
</blockquote>
<pre class="highlight tab tab-json"><code>{
  <span class="hljs-attr">"token"</span>: <span class="hljs-string">"string"</span>,
  <span class="hljs-attr">"text"</span>: <span class="hljs-string">"string"</span>,
  <span class="hljs-attr">"to"</span>: <span class="hljs-string">"string"</span>
}
</code></pre>
<h3 id="---------------------------------parameters">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>In</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>token</td>
<td>body</td>
<td>string</td>
<td>true</td>
<td>none</td>
</tr>
<tr>
<td>text</td>
<td>body</td>
<td>string</td>
<td>true</td>
<td>none</td>
</tr>
<tr>
<td>to</td>
<td>body</td>
<td>string</td>
<td>true</td>
<td>none</td>
</tr>
</tbody>
</table>
<h2 id="------------------------">Получить список диалогов</h2>
<p><a id="opIdget-messages-dialogs"></a></p>
<p><code>GET /messages/dialogs</code></p>
<blockquote>
<p>Пример кода</p>
</blockquote>
<pre class="highlight tab tab-python"><code><span class="hljs-keyword">from</span> astrak <span class="hljs-keyword">import</span> Astrak
<span class="hljs-keyword">import</span> asyncio

astrak_api = Astrak(username=<span class="hljs-string">"username"</span>, password=<span class="hljs-string">"password"</span>)


<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span>
    me = <span class="hljs-keyword">await</span> astrak_api.get_me()
    print(me.id)

    dialogs = <span class="hljs-keyword">await</span> astrak_api.get_all_dialogs()
    print(dialogs)

    <span class="hljs-keyword">await</span> astrak_api.session.close()


loop = asyncio.get_event_loop()
loop.run_until_complete(main())
</code></pre>
<p>Возращает массив со всеми диалогами пользователя.</p>
<blockquote>
<p>Body parameter</p>
</blockquote>
<pre class="highlight tab tab-json"><code>{
  <span class="hljs-attr">"token"</span>: <span class="hljs-string">"string"</span>
}
</code></pre>
<h3 id="-------------------------parameters">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>In</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>token</td>
<td>body</td>
<td>string</td>
<td>true</td>
<td>none</td>
</tr>
</tbody>
</table>
<h2 id="-----------------------------">Получить сообщения из диалога</h2>
<p><a id="opIdget-messages-dialog"></a></p>
<p><code>GET /messages/dialog</code></p>
<p>Возращает массив сообщений с конкретным пользователем.</p>
<blockquote>
<p>Body parameter</p>
</blockquote>
<pre class="highlight tab tab-json"><code>{
  <span class="hljs-attr">"token"</span>: <span class="hljs-string">"string"</span>,
  <span class="hljs-attr">"id"</span>: <span class="hljs-string">"string"</span>
}
</code></pre>
<h3 id="------------------------------parameters">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>In</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>token</td>
<td>body</td>
<td>string</td>
<td>true</td>
<td>none</td>
</tr>
<tr>
<td>id</td>
<td>body</td>
<td>string</td>
<td>true</td>
<td>none</td>
</tr>
</tbody>
</table>
<h2 id="-----------------">Удалить сообщение</h2>
<p><a id="opIdpost-messages-delete"></a></p>
<p><code>POST /messages/delete</code></p>
<p>Удаляет сообщение по его ID.</p>
<blockquote>
<p>Body parameter</p>
</blockquote>
<pre class="highlight tab tab-json"><code>{
  <span class="hljs-attr">"token"</span>: <span class="hljs-string">"string"</span>,
  <span class="hljs-attr">"message_id"</span>: <span class="hljs-string">"string"</span>
}
</code></pre>
<h3 id="------------------parameters">Parameters</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>In</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>token</td>
<td>body</td>
<td>string</td>
<td>true</td>
<td>none</td>
</tr>
<tr>
<td>message_id</td>
<td>body</td>
<td>string</td>
<td>true</td>
<td>ID сообщения. Обычно приходит в событиях</td>
</tr>
</tbody>
</table>
<!-- Renderer: Shins v2.4.1-0 -->
      </div>
      <div class="dark-box">
        
          <div class="lang-selector">
            
              
                <a href="#" data-language-name="python">Python</a>
              
            
              
                <a href="#" data-language-name="js">Javascript</a>
              
            
          </div>
        
      </div>
    </div>
  </body>
</html>
